<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/_template.xhtml">
	<ui:define name="javascripts">
			<h:outputStylesheet library="css" name="bootstrap.css" />
	<h:outputStylesheet library="css" name="estilo.css" />
		<link href="js/video-js/video-js.css" rel="stylesheet" type="text/css" />
		<script src="js/video-js/video.js"></script>
		
		<script>
			var myPlayer = videojs("vdSala");
		</script>
	</ui:define>
	<ui:define name="conteudo_principal">

		<h:outputScript name="jsf.js" library="javax.faces" target="head" />
		<h:outputScript name="common.js" library="js" target="head" />

		<div style="position: absolute; z-index: 1900; margin-top: 50px;">
			<span style="background: white; opacity: 0.6; color: black;">
				<b>ASSISTINDO AGORA:</b>
			</span>
			<h:form>
				<h:dataTable id="dtUsuarios" value="#{geradorUsuariosBean.usuarios}"
					var="usuario">
					<h:column>
						<span
							style="background: white; opacity: 0.6; color: black; font-size: 3">
							#{usuario.login} - #{usuario.uf} </span>
					</h:column>
				</h:dataTable>
				<p:poll interval="1"
					listener="#{geradorUsuariosBean.acrescentarUsuario}"
					update="dtUsuarios" widgetVar="myPoll" autoStart="true" />

				<!-- <a href="#" onclick="myPoll.start();">Gerar</a>
						<a href="#" onclick="myPoll.stop();">Parar</a> -->
			</h:form>
		</div>



		<h:form id="formulario">

			<h:form>
			</h:form>
			<video id="vdSala" controls="true" class="video-js vjs-default-skin"
				width="100%" height="100%"
				data-setup='{"autoplay": true,  "preload": "auto"}'> 
				<source
				src="#{salaBean.videoAtual.urlYoutube}" type="video/mp4" /> 
			</video>
			
			<div id="divVideosPrincipal" style="position: absolute; top: 10%; right: 3%; z-index: 1001;" >
			
				<span style="background: white; opacity: 0.6; color: black;">
				<b>MAPA DE VÍDEOS:</b>
				</span><br />
				
				<span style="background: white; opacity: 0.6; color: black;">
				<b><h:outputText value=" >> #{salaBean.videoAtual.nome}" /></b>
				</span><br />
				
				<ui:repeat id="videosDisp" var="video" value="#{salaBean.videos}"
					varStatus="x">
					<!-- <span id="${x.index}spanMiniatura"
						style="background: #{video.playing== 'true'? 'red': 'blue'}"> -->
					<span id="${x.index}spanMiniatura"> <span id="imgNowPlaying"
						style="width: 30%; background-color: black; color: white; position: absolute; vertical-align: center; opacity: 0.9; border: 2px solid white; visibility: #{video.playing== 'true'? 'visible': 'hidden'}"><center>▶</center></span>
						<!-- <h:outputText value="#{video.disponivel}" />  --> <h:commandLink
							disabled="#{!video.disponivel}"
							action="#{salaBean.selectVideo(video)}">
							<f:ajax render="@all" />
							<h:graphicImage class="thumb" name="${video.arquivo}"
								library="img" title="${video.nome}" width="50" height="30"
								style="margin:10px;border: 2px solid #{video.visited?(video.playing==true?'yellow':'purple'):'white'};opacity: #{video.disponivel == 'true' ? '1.0' : '0.3'};" />
						</h:commandLink>
					</span>


					<br />
					<div id="${x.index}PerguntaVideo"
						style="position: absolute; width: 200%; top: 10%; margin-left: -600px; z-index: 2001; visibility: hidden; opacity: 0.9; color: white; font-size: 6;">
						<span
							style="background: white; opacity: 0.8; color: black; font-size: 4; font-weight: bold;">Escolha o próximo vídeo</span> 
						<span> <ui:repeat
								id="subVideosDisp" var="subvideo"
								value="#{salaBean.videoAtual.proximosVideos}" varStatus="y">

								<h:commandLink action="#{salaBean.selectVideo(subvideo)}">
									<f:ajax render="@all" />

									<h:graphicImage class="thumb" name="${subvideo.arquivo}"
										library="img" width="100%" title="${subvideo.nome}"
										style="margin:10px;border: 2px solid white;" />
								</h:commandLink>

							</ui:repeat>
						</span>


					</div>

				</ui:repeat>
			</div>
			<p:remoteCommand name="liberarProximos"
				action="#{salaBean.liberarProximosVideos}"/>

			<script>
				var mudarDivPergunta = function(_divPergunta) {
					divPergunta = _divPergunta;
				};

				var myPlayer = videojs("vdSala");
				var mostrarDivPergunta = function() {
					liberarProximos();
					document.getElementById(divPergunta).style.visibility = "visible";
				};
				myPlayer.on("ended", mostrarDivPergunta);
				myPlayer.play();

				var divPergunta = "1PerguntaVideo";
				var divRedirecionarCadastrar = "";

				function redirecionarCadastrar(_redirecionarCadastrar) {
					alert(_redirecionarCadastrar);
					divRedirecionarCadastrar = _redirecionarCadastrar;
				}
			</script>

		</h:form>



	</ui:define>
</ui:composition>
</html>